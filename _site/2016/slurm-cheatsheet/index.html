<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Slurm Cheatsheet | Notes </title> <meta name="description" content=" Microbes + Biogeochemistry "> <meta name="keywords" content="Marine, microbial ecology, bacteria, biogeochemistry, ocean"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Shane Hogle"> <meta property="article:section" content=""> <meta property="article:tag" content=""> <meta property="article:published_time" content="2016-12-04 00:00:00 -0500"> <meta property="og:url" content="http://slhogle.github.io/2016/slurm-cheatsheet/"> <meta property="og:title" content=" Slurm Cheatsheet | Notes "> <meta property="og:image" content="http://slhogle.github.io"> <meta property="og:description" content=" Microbes + Biogeochemistry "> <meta property="og:site_name" content="Shane Hogle"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@slhogle"> <meta name="twitter:title" content=" Slurm Cheatsheet | Notes "> <meta name="twitter:description" content=" Microbes + Biogeochemistry "> <meta name="twitter:image:src" content="http://slhogle.github.io"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Slurm Cheatsheet | Notes "> <meta itemprop="description" content=" Microbes + Biogeochemistry "> <meta itemprop="image" content="http://slhogle.github.io"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="stylesheet" href="/assets/css/font-awesome.min.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://slhogle.github.io/2016/slurm-cheatsheet/"> <link rel="alternate" type="application/rss+xml" title="Notes" href="http://slhogle.github.io/feed.xml"> <script type="text/javascript"> var disqus_shortname = 'slhogle-site'; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-XXXXX-XX']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">Notes<span></span></a></h1> <ul class="navbar"> <li><a href="/about">about</a></li> <li><a href="/research">research</a></li> <li><a href="/publications">publications</a></li> <li><a href="/biographical_sketch">biographical sketch</a></li> <li><a href="/contact">contact</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"><time datetime="2016-12-04T00:00:00-05:00" itemprop="datePublished">Dec 4, 2016</time></p> <h1 class="post-title" itemprop="name headline">Slurm Cheatsheet</h1> </header> <div class="post-content" itemprop="articleBody"> <ul> <li>General SLURM documentation found <a href="https://slurm.schedmd.com/">here</a></li> <li>SLURM <a href="https://slurm.schedmd.com/tutorials.html">tutorials</a></li> <li>SLURM tools <a href="https://www.youtube.com/watch?v=U42qlYkzP9k&amp;feature=player_embedded">youtube video</a></li> <li>SLURM <a href="https://rc.fas.harvard.edu/resources/running-jobs/">tutorial</a> @ Harvard</li> </ul> <h3 id="submitting-and-cancelling-slurm-jobs">Submitting and cancelling SLURM jobs</h3> <p>Submit a job script called my_script.sh requesting</p> <ul> <li>5GB RAM per cpu</li> <li>20 CPUs on a single node</li> <li>use the scheduler queue $MYQUEUE</li> <li>use the job name $MYJOB_NAME</li> <li>provide a time ceiling of 3 HRs</li> <li>write STDOUT to file $MYLOG.log</li> </ul> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">sbatch --mem-per-cpu 5GB -c 20 -p <span class="nv">$MYQUEUE</span> -J <span class="nv">$MYJOB_NAME</span> -t 0-3:00:00 -o <span class="nv">$MYLOG</span>.log my_script.sh

<span class="c"># Cancel a task with the related JOB_ID</span>
scancel <span class="nv">$MYJOB_ID</span></code></pre></figure> <p>Submit an interactive job</p> <ul> <li>2GB RAM per cpu</li> <li>4 CPUs on a single node</li> <li>use the scheduler queue $MYQUEUE</li> <li>provide a time ceiling of 1 HR</li> <li>execute task zero in pseudo terminal mode. The option “pty” is important because it allows an interactive terminal mode. Without “pty” every command issued would be run 4 times</li> </ul> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">srun --mem-per-cpu 2GB -c 4 -p <span class="nv">$MYQUEUE</span> -t 0-01:00:00 --pty /bin/bash

<span class="c"># Use srun for any long jobs, even cp or rsync</span>
<span class="c"># DONT USE THE LOGIN NODE</span>
srun -p <span class="nv">$MYQUEUE</span> cp my_file my_new_file</code></pre></figure> <h3 id="jobs-can-be-submitted-by-passing-all-slurm-parameters-through-bash-script">Jobs can be submitted by passing all SLURM parameters through bash script</h3> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/usr/bin/env bash</span>
<span class="c">#SBATCH --mem-per-cpu 5GB</span>
<span class="c">#SBATCH -c 20</span>
<span class="c">#SBATCH -p $MYQUEUE</span>
<span class="c">#SBATCH -J $MYJOB</span>
<span class="c">#SBATCH -t 0-3:00:00</span>
<span class="c">#SBATCH -o $MYLOG.log my_script.sh</span>

raxmlHPC-PTHREADS-AVX -T 20 <span class="se">\</span>
-m GTRGAMMA <span class="se">\</span>
-p 82748 <span class="se">\</span>
<span class="gp">-# </span>20 <span class="se">\</span>
-s <span class="nv">$MY_PHYLIP_FILE</span> <span class="se">\</span>
-n <span class="nv">$MY_NAME</span> <span class="se">\</span>
-o <span class="nv">$MY_OUTGROUP</span> <span class="se">\</span>
-w <span class="nv">$MY_OUTDIR</span></code></pre></figure> <p>Run the RAxML analysis as</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">sbatch my_raxml_script.sh</code></pre></figure> <h3 id="find-information-about-partitions-and-jobs">Find information about partitions and jobs</h3> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Display submitted jobs for a given user</span>
squeue -u <span class="nv">$USER</span></code></pre></figure> <p>List job information</p> <ul> <li>The sacct command displays job accounting data stored in the job accounting log file or Slurm database in a variety of forms for your analysis. The sacct command displays information on jobs, job steps, status, and exitcodes by default. For the non-root user, the sacct command limits the display of job accounting data to jobs that were launched with their own user identifier (UID) by default. Data for other users can be displayed with the –allusers, –user, or –uid options.</li> </ul> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">sacct --format<span class="o">=</span><span class="s2">"CPUTime,MaxRSS,AveRSS,JobName,Timelimit,Start,Elapsed"</span>

<span class="c"># Display available partitions on the cluster</span>
sinfo

<span class="c"># List jobs that ran since Dec 1st 2016</span>
sacct -S 2016-12-01

<span class="c"># Get help about sacct command</span>
sacct --helpformat</code></pre></figure> <aside class="share"> <p>Share this post on <a href="http://twitter.com/share?text=Slurm Cheatsheet&amp;url=http://slhogle.github.io/2016/slurm-cheatsheet/&amp;via=slhogle" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter <i class="fa fa-twitter" aria-hidden="true" style="color:#00aced"></i></a> </p> </aside> </div> </article> <footer class="site-footer"> <div class="container"> <div align="center"> <small class="block">&copy; 2017 Shane Hogle. All rights reserved.</small> </div> </div> </footer> </main> </body> </html>
